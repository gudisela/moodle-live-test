<!DOCTYPE html>
<html>
<head>
    <title>Exam Question</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .container { display: flex; gap: 20px; }
        .box { border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>

<h2>Question {{ qid }}</h2>

<div class="container">

    <!-- Left: Diagram with drawing overlay -->
    <div class="box">
        <h3>Diagram (Draw on it)</h3>
        <div style="position: relative;">
            <img id="diagramImage"
                 src="/question_file/{{ qid }}/{{ diagram_image }}"
                 style="width: 400px;">

            <canvas id="drawCanvas"
                    width="400"
                    height="300"
                    style="border:1px solid black; position:absolute; left:0; top:0;"></canvas>
        </div>
    </div>

    <!-- Right: Question text -->
    <div class="box">
        <h3>Question</h3>
        <img src="/question_file/{{ qid }}/{{ question_image }}" style="width: 400px;">
    </div>

</div>

<br>

<h3>Your Answer</h3>
<textarea id="answerText" style="width: 100%; height: 120px;"></textarea>

<br><br>

<button onclick="submitAnswer()">Submit Answer</button>

<script>
// Simple drawing on canvas
let canvas = document.getElementById("drawCanvas");
let ctx = canvas.getContext("2d");
let drawing = false;

canvas.addEventListener("mousedown", () => drawing = true);
canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mousemove", draw);

function draw(e) {
    if (!drawing) return;
    ctx.lineWidth = 3;
    ctx.lineCap = "round";
    ctx.strokeStyle = "black";

    let rect = canvas.getBoundingClientRect();
    ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
}

// Save everything
function submitAnswer() {
    let overlayImage = canvas.toDataURL("image/png");

    fetch("/save_exam_answer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            qid: "{{ qid }}",
            studentName: "Student1",
            answerText: document.getElementById("answerText").value,
            overlayImage: overlayImage
        })
    })
    .then(res => res.json())
    .then(data => alert("Answer submitted!"));
}
</script>

</body>
</html>
