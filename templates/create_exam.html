<!DOCTYPE html>
<html>
<head>
    <title>Create Exam</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 80px; }
        canvas { border: 1px solid #000; margin-top: 10px; }
        .question-block { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
    </style>
</head>
<body>

<h2>Create Exam</h2>

<form action="/teacher/save_exam" method="POST">

    <label>Exam ID:</label><br>
    <input type="text" name="exam_id" required><br><br>

    <label>Exam Title:</label><br>
    <input type="text" name="title" required><br><br>

    <div id="questions"></div>

    <button type="button" onclick="addQuestion()">+ Add Question</button><br><br>

    <button type="submit">Save Exam</button>
</form>

<script>
let qCount = 0;

function addQuestion() {
    qCount++;
    const qDiv = document.createElement("div");
    qDiv.className = "question-block";
    qDiv.innerHTML = `
        <h3>Question ${qCount}</h3>
        <textarea name="qtext_${qCount}" placeholder="Enter question text"></textarea><br><br>

        <label>Diagram:</label><br>
        <canvas id="canvas_${qCount}" width="400" height="250"></canvas>
        <input type="hidden" name="diagram_${qCount}" id="diagram_${qCount}">

        <br><button type="button" onclick="saveDiagram(${qCount})">Save Diagram</button>
    `;

    document.getElementById("questions").appendChild(qDiv);

    initCanvas(qCount);
}

function initCanvas(id) {
    const canvas = document.getElementById("canvas_" + id);
    const ctx = canvas.getContext("2d");

    let drawing = false;
    let startX, startY;

    canvas.onmousedown = (e) => {
        drawing = true;
        startX = e.offsetX;
        startY = e.offsetY;
    };

    canvas.onmouseup = (e) => {
        if (!drawing) return;
        drawing = false;

        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
    };
}

function saveDiagram(id) {
    const canvas = document.getElementById("canvas_" + id);
    const data = canvas.toDataURL("image/png");
    document.getElementById("diagram_" + id).value = data;
    alert("Diagram Saved!");
}
</script>

</body>
</html>
