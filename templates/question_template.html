<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>IGCSE Structured Question</title>

<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .row { display: flex; gap: 30px; }
    .diagram-box {
        width: 60%;
        border: 1px solid #aaa;
        padding: 10px;
        min-height: 350px;
    }
    .diagram-box img {
        width: 100%; 
        height: auto;
    }
    .question-box {
        width: 40%;
        border: 1px solid #aaa;
        padding: 10px;
        background: #f8f8f8;
    }
    .answer-box {
        margin-top: 30px;
    }
    textarea {
        width: 100%;
        height: 180px;
        font-size: 16px;
        padding: 10px;
    }
    button {
        margin-top: 15px;
        padding: 12px 20px;
        font-size: 16px;
    }
</style>
</head>

<body>

<h2>IGCSE Physics — Structured Question</h2>

<!-- Row containing Diagram + Question -->
<div class="row">

    <!-- Left: Diagram -->
    <div class="diagram-box">
        <img src="/get_diagram/{{ diagram_filename }}" alt="diagram">
    </div>

    <!-- Right: Question Text -->
    <div class="question-box">
        <h3>Question</h3>
        <p>{{ question_text|safe }}</p>

        <p><b>Write your answers in this order:</b></p>
        <ul>
            {% for p in parts %}
              <li>{{ p }}</li>
            {% endfor %}
        </ul>
    </div>

</div>

<!-- Answer Area -->
<div class="answer-box">
    <label><b>Your Answer (write in order i, ii, iii …)</b></label>
    <textarea id="student_answer"></textarea>

    <label style="margin-top:10px;">Student Name</label>
    <input id="student_name" type="text" style="width:100%; padding:8px; font-size:16px;">

    <button onclick="submitAnswer()">Save & Submit</button>

    <div id="status"></div>
</div>

<script>
function submitAnswer() {

    const payload = {
        diagram: "{{ diagram_filename }}",
        question: "{{ question_id }}",
        student: document.getElementById("student_name").value,
        answer: document.getElementById("student_answer").value,
        timestamp: new Date().toISOString().replace(/[-:T.]/g,'').slice(0,14)
    };

    fetch("/submit_fixed_question", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(d => {
        document.getElementById("status").textContent = d.status;
        alert("Saved!");
    });
}
</script>

</body>
</html>
